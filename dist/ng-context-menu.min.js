angular.module("ng-context-menu",[]).factory("ContextMenuService",function(){return{element:null,menuElement:null}}).directive("contextMenu",["$document","ContextMenuService",function(e,n){return{restrict:"A",scope:{callback:"&contextMenu",disabled:"&contextMenuDisabled",closeCallback:"&contextMenuClose"},link:function(t,l,c){function o(n,t){t.addClass("open"),t.css("position","fixed");var l=e[0].documentElement,c=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),o=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),u=t[0].scrollWidth,i=t[0].scrollHeight,a=l.clientWidth+c,m=l.clientHeight+o,s=u+n.pageX,p=i+n.pageY,r=Math.max(n.pageX-c,0),f=Math.max(n.pageY-o,0);s>a&&(r-=s-a),p>m&&(f-=p-m),t.css("top",f+"px"),t.css("left",r+"px"),d=!0}function u(e){e.removeClass("open"),d&&t.closeCallback(),d=!1}function i(e){!t.disabled()&&d&&27===e.keyCode&&t.$apply(function(){u(n.menuElement)})}function a(e){t.disabled()||!d||2===e.button&&e.target===n.element||t.$apply(function(){u(n.menuElement)})}var d=!1,m=c.contextMenuEvent?c.contextMenuEvent:"contextmenu";l.bind(m,function(e){t.disabled()||(null!==n.menuElement&&u(n.menuElement),n.menuElement=angular.element(document.getElementById(c.target)),n.element=e.target,e.preventDefault(),e.stopPropagation(),t.$apply(function(){t.callback({$event:e})}),t.$apply(function(){o(e,n.menuElement)}))}),e.bind("keyup",i),e.bind("click",a),e.bind("contextmenu",a),t.$on("$destroy",function(){e.unbind("keyup",i),e.unbind("click",a),e.unbind("contextmenu",a)})}}}]);
